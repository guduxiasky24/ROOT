var isLoadScrollJs=false;$.fn.miniCartTool=function(){var I=$(this);var k=I.children("div.f-unfold-title");var d=I.find("div.cartEmpty");var E=I.find("div.loading-2015");var y=I.find("div.unfold-list");var m=I.children("div.f-unfold-pay");var l=I.find("#cart_box");var s=$www;var z=$(".wrapper");var q=$("#divRTCartMain");var u=$("#ulRToolList").find(".f-shopping-cart");var H=33;var C=72;var i=84-22;var A=/^\d+$/;var D=$(window).height();var j=(D-50)/2;var B=(D-89)/2;E.css("padding",j+"px 0px");I.css({height:D-2}).show();var t=37;if(/(msie\s|trident.*rv:)([\w.]+)/.test(navigator.userAgent.toLowerCase())&&parseInt($.browser.version)==6){t=36}$.ajax({url:"/mycart/buyProductClick.html",success:function(K){var L=0;if(K!=""){L=K.productCount}else{L=0}if(L>0){u.addClass("f-checked");I.stop().animate({right:t},{duration:400,queue:false,complete:function(){}})}}});l.height(D-H-i-8);var G=function(K){if(K&&K.stopPropagation){K.stopPropagation()}else{window.event.cancelBubble=true}};var h=function(M,K,L,O){var N=function(){L.apply(O,arguments)};window.addEventListener?M.addEventListener(K,N,false):M.attachEvent("on"+K,N)},b=function(M,K,L){window.removeEventListener?M.removeEventListener(K,L,false):M.attachEvent("on"+K,L)};z.click(function(K){K=K||window.event;G(K);I.stop().animate({right:-240},{duration:500,queue:false,complete:function(){u.removeClass("f-checked")}})});q.click(function(K){K=K||window.event;G(K)});var F=function(){var L=0;var K=0;var M=0;y.children("dl").each(function(){M=parseInt($(this).attr("buyNum"));if(!A.test(M)){return}L++;K+=M});m.find("li.total-txt").html('\u5171<em class="orange">'+L+'</em>\u4e2a\u5546\u54c1\u5408\u8ba1\uff1a<b class="orange">'+K+".00</b>\u5143")};var r="\u5df2\u8d85\u8fc7100\u4eba\u6b21";var J="\u6700\u5c11\u9700"+$shortName+"1\u4eba\u6b21";$.fn.cartFun=function(){$(this).hover(function(){$(this).addClass("hover");$(this).find("input:text").val($(this).attr("buyNum"));$(this).find("p").eq(0).hide().next().show();if($(this).attr("bind")!="1"){K($(this));$(this).attr("bind","1")}},function(){$(this).removeClass("hover");$(this).find("p").eq(0).show().next().hide()});var K=function(R){var V=R;var aa=V.attr("codeid");var L=V.find("input:text");var T=parseInt(L.attr("surplus"));var X=parseInt(L.attr("limitbuy"));var P=parseInt(L.attr("mylimitsales"));var N=parseInt(X-P);var Z=L.prev();var M=L.next();var Q=V.find("#miniTips");var W=parseInt(L.val());var S=function(){if(X>0){Q.removeClass("orange").addClass("gray6").html("\u9650\u8d2d"+X+"\u4eba\u6b21")}else{Q.html("")}};S();var U=function(ab){if(X>0){if(ab!=""){Q.removeClass("gray6").addClass("orange").html(ab)}else{if(P>0){Q.removeClass("gray6").addClass("orange").html("\u60a8\u5df2\u53c2\u4e0e"+P+"\u4eba\u6b21");setTimeout(function(){Q.removeClass("orange").addClass("gray6").html("\u9650\u8d2d"+X+"\u4eba\u6b21")},1500)}else{Q.removeClass("orange").addClass("gray6").html("\u9650\u8d2d"+X+"\u4eba\u6b21")}}}else{Q.removeClass("gray6").addClass("orange").html(ab)}};var Y=function(ab){if(!A.test(ab)){W=1;L.val("");V.attr("buyNum","1").find("cite").eq(0).html("<em>"+$shortName+"\u4eba\u6b21\uff1a</em>1").next().html("<em>\u5c0f\u8ba1\uff1a</em>\uffe51.00");O();F();return}if(parseInt(V.attr("buyNum"))!=ab){var count=parseInt(ab);var codeid=aa;var json=getCookie("products");if(json==null||json==""){var val="[{'pId':"+codeid+",'num':"+ab+"}]";SetCookieByExpires("products",val,1)}else{var flag=false;json=eval("("+json+")");$.each(json,function(n,value){if(codeid==value.pId){value.num=parseInt(ab);if(parseInt(ab)>count){value.num=count}flag=true}});if(!flag){json.push({pId:+codeid,num:ab})}json=JSON.stringify(json);SetCookieByExpires("products",json,1)}W=ab;L.val(ab);V.attr("buyNum",W).find("cite").eq(0).html("<em>\u60ca\u559c\u4eba\u6b21\uff1a</em>"+W).next().html("<em>\u5c0f\u8ba1\uff1a</em>\uffe5"+W+".00");O();F()}else{L.val(V.attr("buyNum"))}};var O=function(){if(W==1){Z.addClass("unclick");M.removeClass("unclick")}else{if(W==T||(W==N&&X>0)){Z.removeClass("unclick");M.addClass("unclick")}else{Z.removeClass("unclick");M.removeClass("unclick")}}};L.keyup(function(ac){var ab=L.val();if(ab==""){Y(1)}else{if(!A.test(ab)){S();Y(W)}else{ab=parseInt(ab);if(ab==0){U(J);Y(1)}else{if(ab<=T){if(X>0){if(ab>N){ab=N;U("")}else{if(ab>100){U(r)}else{S()}}}else{if(ab>100){U(r)}else{S()}}Y(ab)}else{ab=T;if(X>0){if(ab>N){ab=N;U("")}else{U("\u6700\u591a\u53ef"+$shortName+ab+"\u4eba\u6b21")}}else{U("\u6700\u591a\u53ef"+$shortName+ab+"\u4eba\u6b21")}Y(ab)}}}O()}}).mouseover(function(){$(this).attr("mouseIn","1").focus().select();scrollFunc=function(ad){ad=ad||window.event;if(ad&&ad.preventDefault){ad.preventDefault()}else{window.event.returnValue=false}G(ad);var ae=0;if(ad.wheelDelta){ae=ad.wheelDelta>0?1:-1}else{if(ad.detail){ae=ad.detail<0?1:-1}}if(ae&&L.attr("mouseIn")=="1"){var ac=parseInt(L.val());if(ae>0){if(ac>0){if(ac>=T){ac=T;if(X>0){if(ac>N){ac=N;U("")}else{U("\u6700\u591a\u53ef"+$shortName+ac+"\u4eba\u6b21")}}else{U("\u6700\u591a\u53ef"+$shortName+ac+"\u4eba\u6b21")}}else{S();ac=ac+1;if(X>0){if(ac>N){ac=N;U("")}else{if(ac>100){U(r)}else{S()}}}else{if(ac>100){U(r)}else{S()}}}}else{ac=1}}else{if(ac>1){ac=ac-1;if(ac>100){U(r)}else{S()}}else{ac=1;if(X==0){U(J)}}}L.val(ac);O()}};var ab=$(this).get(0);h(ab,"mousewheel",scrollFunc,ab);h(ab,"DOMMouseScroll",scrollFunc,ab)}).mouseout(function(){$(this).attr("mouseIn","0");var ac=L.val();if(ac>T){ac=T}Y(ac);var ab=$(this).get(0);b(ab,"mousewheel",scrollFunc);b(ab,"DOMMouseScroll",scrollFunc)}).blur(function(){if(L.val()==""){W=1;L.val("1");V.attr("buyNum","1").find("cite").eq(0).html("<em>"+$shortName+"\u4eba\u6b21\uff1a</em>1").next().html("<em>\u5c0f\u8ba1\uff1a</em>\uffe51.00");O();F()}});Z.click(function(){var ab=L.val();if(A.test(ab)){var ac=parseInt(ab);if(ac>1){ac--;if(ac>100){U(r)}else{S()}Y(ac);if(ac==1){Z.addClass("unclick")}M.removeClass("unclick")}else{}}return false});M.click(function(){var ab=L.val();if(A.test(ab)){var ac=parseInt(ab);if(ac<T){S();ac++;if(X>0){if(ac>N){ac=N;U("")}}else{if(ac>100){U(r)}else{S()}}Y(ac);Z.removeClass("unclick");if(ac==T||(ac==N&&X>0)){M.addClass("unclick")}}else{ac=T;if(X>0){if(ac>N){ac=N;U("")}else{U("\u6700\u591a\u53ef"+$shortName+ac+"\u4eba\u6b21")}}else{U("\u6700\u591a\u53ef"+$shortName+ac+"\u4eba\u6b21")}Y(ac)}}return false});V.find("dd.z-close a").click(function(ab){G(ab);var at=aa;var json=getCookie("products");if(json!=null||json!=""){json=eval("("+json+")");var is=0;$.each(json,function(n,value){if(at==value.pId){is=n}});json.splice(is,1);json=JSON.stringify(json);SetCookieByExpires("products",json,1);v();$.ajax({url:"/mycart/buyProductClick.html",success:function(K){var ae=0;if(K!=""){ae=K.productCount}else{ae=0}if(ae==0){u.removeClass("f-checked");I.stop().animate({right:-240},{duration:400,queue:false,complete:function(){}})}}});return}return false})}};var a=function(M,Q,T,K,U,P,L,N){var V="";var R=K>0;var O=parseInt(L)-parseInt(N);var W=(P==3&&N==L)?1:0;V='<dl codeid="'+M+'" buyNum="'+(R?T:0)+'" class="'+(R?"":"hover")+'"><dd><a href="'+mainHttp+"/products/"+M+'.html" title="'+U+'" target="_blank"><img src="'+$img+Q+'" /></a>'+(P==3?'<b class="limitbuy-icon"></b>':"")+'</dd><dd class="z-ygrc">'+(R?'<p class="two-row"><cite><em>'+$shortName+"\u4eba\u6b21\uff1a</em>"+T+"</cite><cite><em>\u5c0f\u8ba1\uff1a</em>\uffe5"+T+'.00</cite></p><p class="three-row"><span class="gray6">\u5269\u4f59 '+K+'\u4eba\u6b21</span><span class="modify"><a href="javascript:;" class="'+(T==1?"unclick":"")+'">-</a><input type="text" value="'+T+'" surplus="'+K+'" limitbuy="'+L+'" mylimitsales="'+N+'"/><a href="javascript:;" class="'+((T==K||T==O)?"unclick":"")+'">+</a></span><span id="miniTips">'+(P==3?"\u9650\u8d2d"+L+"\u4eba\u6b21":"")+"</span></p>":'<p class="three-row"><span class="gray6" style="margin-top:20px;">\u5df2\u5931\u6548</span></p>')+'</dd><dd class="z-close"><a href="javascript:;" title="\u5220\u9664" class="delete-close transparent-png"></a></dd></dl>';if(W==1){V='<dl codeid="'+M+'" buyNum="0" class="hover" ><dd><a href="'+mainHttp+"/products/"+M+'.html" title="'+U+'" target="_blank"><img src="'+$img+Q+'" /></a><b class="limitbuy-icon"></b></dd><dd class="z-ygrc"><p class="three-row"><span class="gray6" style="margin-top:20px;"> \u60a8\u53c2\u4e0e\u4eba\u6b21\u5df2\u8fbe\u4e0a\u9650</span></p></dd><dd class="z-close"><a href="javascript:;" title="\u5220\u9664" class="delete-close transparent-png"></a></dd></dl>'}var S=$(V);if(R&&W!=1){S.cartFun()}else{S.find("dd.z-close a").click(function(X){G(X);var at=$(this).parent().parent().attr("codeid");var json=getCookie("products");if(json!=null||json!=""){json=eval("("+json+")");var is=0;$.each(json,function(n,value){if(at==value.pId){is=n}});json.splice(is,1);json=JSON.stringify(json);SetCookieByExpires("products",json,1);v();return}return false})}return S};var o=function(){var K=D-H-i;return K%C==0?K/C:parseInt(K/C)-1};var n=$("#divRTLogin");var f=$(window).height();var e="/login/miniLogin.html?url="+escape(location.href);var g='<iframe name="ifmLogin" id="ifmLogin" src="about:blank" frameborder="0" style="width: 240px; height: 227px; padding: 0px; overflow: auto;"></iframe>';var p=function(){var K=$(window).height()-227;n.show().attr("isOpen","1").css({top:K,zIndex:"10"});if(n.html().length==0){n.html(g+'<a href="javascript:;" class="delete-close transparent-png"></a>');var L=$("#ifmLogin");L.ready(function(){try{L.attr("src",e);n.find("a.delete-close").unbind("click").click(function(){n.attr("isOpen","0").animate({top:f},{queue:false,duration:100});return false})}catch(M){alert(M)}})}};var w=$("#ulRToolList").children("li:first").find("em");var c=$("#spHCart");var x=true;var v=function(){$.ajax({url:"/mycart/getMyProductCart.html",data:"date="+new Date().getTime(),success:function(O){_IsCartChanged=false;if(O!=null&&O!=""){if(O.length>0){var K=O[O.length-1].productCount;var S=O[O.length-1].moneyCount;var N=O;k.show();E.hide();d.hide();y.empty().show();var T=o();var Q=N.length;for(var P=0;P<Q;P++){var M=a(N[P].productId,N[P].headImage,N[P].count,(N[P].productPrice-N[P].currentBuyCount),N[P].productName,N[P].productStyle,N[P].productLimit,N[P].myLimitSales);y.append(M)}var O="<ul>";O+='<li class="total-txt">\u5171<em class="orange">'+K+'</em>\u4e2a\u5546\u54c1\uff0c\u5408\u8ba1\uff1a<b class="orange">'+S+'.00</b>\u5143</li><li class="accounts-btn"><a type="pay" href="javascript:;" title="\u53bb\u7ed3\u7b97">\u53bb\u7ed3\u7b97</a></li>';O+="</ul>";var R=$(O);R.find('a[type="pay"]').click(function(){var userId=getCookie("userId");if(userId!=null){location.href=s+"/mycart/payment.html"}else{p()}return false});m.empty().append(R).show();w.html(K).show();c.html("("+K+")");y.css("top","0px");l.show().children("div.iscroll-drap-parent").remove();if(Q>T){var L=function(){isLoadScrollJs=true;new iScroll("cart_box");l.hover(function(){l.children("div.iscroll-drap-parent").fadeIn("slow")},function(){l.children("div.iscroll-drap-parent").fadeOut("slow")});if(x){l.children("div.iscroll-drap-parent").hide()}};if(!isLoadScrollJs){$.getScript("/js/iscroll.js?date=150203",L)}else{L()}}else{return}}x=false}else{k.hide();E.hide();l.hide();y.hide();m.hide();d.css("padding",B+"px 0px").show();w.html("0").hide();c.html("")}}})};if(_IsCartChanged){E.show();v()}_InsertIntoCart=function(){_IsCartChanged=true;if(n.attr("isOpen")=="1"){v()}else{$.ajax({url:"/mycart/buyProductClick.html",data:"date="+new Date().getTime(),success:function(K){var L=0;if(K!=""){L=K.productCount}else{L=0}c.html("("+L+")");L=L>99?"...":L;w.html(L).show()}})}}};
