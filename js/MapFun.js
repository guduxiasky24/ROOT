var getOrderNextPageFun=null;var RUFun=null;var RGFun=null;$(document).ready(function(){function t(M,L,J,K){$.getJSON(M+"/JPDataMap?action="+L+"&"+J+"&fun=?",K)}var j=$(".MapInfoCon");var e=j.find("div.searchContent").html();var c=$("#MapInfoTab");var s=$("#liNav").html();var p=$("#divMore");var b=$("#pageDialogBG");var q=$("#keywords");var g=$("#keyword");var h="mapCity";var C=null;var n=null;var u;var x=null;var B=false;var D=null;var E=1;var w;var I;var a="getAreastatByLevel";var F;var i=false;var v=true;var r=false;var A=false;var f=true;var y=true;var m=0;var d=true;var H="http://api.1yyg.com";var o={action:"getAreastatByLevel",zoom:"5",lng1:"116.404",lat1:"39.915",lng2:"116.404",lat2:"39.915",level:"1",keywords:"",querytype:"0",fidx:1,eidx:3,iscount:1};var z=parseInt($("div.header").css("height"))+parseInt($("div.copyright").css("height"))+34;var l=function(){var J=$(window).width();if(J<1000){$("#mainBox").css("width","1000px")}else{$("#mainBox").css("width","100%")}_Height=$(window).height()-z;if(_Height>100){if(_Height<560){_Height=560}$("#allmap").css("height",_Height+"px");c.css("top",(_Height-80)/2+"px");j.css("height",_Height+"px").find("div.shadowRight s").css({height:_Height+"px"})}};l();var k=function(){var W=null;var Z=null;var aq=function(ac){W=ac;setTimeout(function(){W=null},60000)};var J=function(ac){Z=ac;setTimeout(function(){Z=null},60000)};C=n=new BMap.Point(1,1);var an=new BMap.Map("allmap",{minZoom:5,enableMapClick:false});function P(){var ac=$.cookie(h);if(ac==null||ac==""){w=new BMap.Point(116.4035,39.915);an.centerAndZoom(w,5)}else{var ar=ac.toString().split(",");w=new BMap.Point(ar[0],ar[1]);an.centerAndZoom(w,12)}var at=new BMap.LocalCity();at.get(aa);F=an.getCenter();an.addControl(new BMap.NavigationControl());an.addControl(new BMap.ScaleControl());an.addControl(new BMap.OverviewMapControl());an.enableScrollWheelZoom(true);an.addEventListener("tilesloaded",function(){if(d){var aA={position:au,offset:new BMap.Size(-85,-23)};var ax=new BMap.Label('<span id="1yyglogo" style="color:#22AAFF; margin:0 3;">深圳市一元云购网络科技有限公司</span>',aA);ax.setStyle({color:"#666",fontSize:"12px",height:"20px",lineHeight:"20px",fontFamily:"宋体",borderRadius:"3px",border:"1px solid #FFA366",padding:"0 5px",background:"#FFFFE3"});ax.setZIndex(10000);var aw=new BMap.Icon("http://skin.1yyg.com/map/images/logomarker.png",new BMap.Size(23,36),{anchor:new BMap.Size(12,22)});var au=new BMap.Point(114.093801,22.554205);var av=new BMap.Marker(au,{icon:aw,offset:new BMap.Size(3,-12)});av.disableMassClear();av.setZIndex(10000);an.addOverlay(av);av.addEventListener("mouseover",function(){this.setLabel(ax)});av.addEventListener("mouseout",function(){if(this.getLabel()!=null){this.getLabel().remove()}});var az='<div class="m_boxCon"><div class="m_title"><b class="gray6">深圳市一元云购网络科技有限公司</b></div><div class="blockCon"><ul><li class="company"><span><a target="_blank" href="http://help.1yyg.com/htm-about.html" title="关于云购"><img src="http://skin.1yyg.com/map/images/company.jpg"/></a></span><dl><dt><p>地 址：深圳市福田区红荔路38号群星广场A座24层</p></dt><dd>热 线：<em>400-850-8080</em></dd><dd>传 真：<em>0755-33918791</em></dd><dd>邮 箱：<em>service@1yyg.com</em></dd></dl></li></ul></div></div>';var ay=new BMap.InfoWindow(az,{enableMessage:false});ay.setWidth(330);av.addEventListener("click",function(){this.openInfoWindow(ay)});an.addEventListener("zoomend",aj);an.addEventListener("moveend",Q);d=false;aj()}})}P();function aa(ac){var ar=new BMap.Geocoder();ar.getPoint(ac.name,function(at){if(at){$.cookie(h,at.lng+","+at.lat,{expires:7,path:"/"});if(w.lng!=at.lng||w.lat!=at.lat){an.centerAndZoom(at,12)}}},"")}var S=$("#helpIcon");var ae=$("#helpDesc");S.hover(function(){$(this).addClass("hover");ae.show()},function(){$(this).removeClass("hover");ae.hide()});c.bind("click",function(){T(true)});var T=function(ac){if(c.attr("class")=="expand"&&c.css("display")=="block"){if(ac){j.animate({right:"-265px"},{duration:800,complete:function(){c.addClass("expand2")}})}}else{if(E!=1){j.animate({right:"0"},{duration:800,complete:function(){c.removeClass("expand2")}})}}return true};var ad=false;var aj=function(){var ac=an.getZoom();if(!f){m=ac;return}if(ac>=18&&i){i=false;ad=true;o.level=4}else{if(m>ac&&ac>14){ad=true;o.level=4}else{if(ac==14){ad=true;o.level=4}else{if(ac==12||ac==13){ad=true;o.level=3}else{if((m>11||m<7)&&7<=ac&&ac<=11){ad=true;o.level=2}else{if(m>6&&3<=ac&&ac<=6){ad=true;o.level=1}}}}}}m=ac;if(ad){ad=false;if(ac>=14&&v){o.action="getDetailPointByAreaid"}else{o.action=a}f=true;y=false;V()}else{f=true;y=true}};var R=false;var Q=function(){if(!y){return}var at=an.getCenter();var ac=Math.abs(at.lng-F.lng);var au=Math.abs(at.lat-F.lat);var ar=an.getZoom();if(ar==18){if(ac>0.001||au>0.001){o.level=4;R=true}}else{if(ar==17){if(ac>0.003||au>0.003){o.level=4;R=true}}else{if(ar==16){if(ac>0.006||au>0.006){o.level=4;R=true}}else{if(ar>=14){if(ac>0.015||au>0.015){o.level=4;R=true}}else{if(ar==13){if(ac>0.02||au>0.02){o.level=3;R=true}}else{if(ar==12){if(ac>0.08||au>0.08){o.level=3;R=true}}}}}}}if(R){_MoveCount=0;R=false;if(ar>=14&&v){o.action="getDetailPointByAreaid"}else{o.action=a}i=true;f=false;y=true;F=at;V()}else{f=true;y=true}};var V=function(){var au=an.getBounds();var ax=au.getSouthWest();var at=au.getNorthEast();o.lng1=ax.lng;o.lat1=ax.lat;o.lng2=at.lng;o.lat2=at.lat;var aw=at.lng+""+at.lat;reqPointSign=aw;var av=o.level;var ar=E;an.clearOverlays();var ac=function(aD){if(aD.code==0&&aw==reqPointSign){if(av==1&&ar==1){aq(aD)}else{if(av==2&&ar==1){J(aD)}}result=aD.result;if(av==4&&result.length>100&&an.getZoom()<17){if(document.createElement("canvas").getContext){var aC=[];for(var aA=0;aA<result.length;aA++){aC.push(new BMap.Point(result[aA].longitude,result[aA].latitude))}var az={size:BMAP_POINT_SIZE_NORMAL,shape:BMAP_POINT_SHAPE_WATERDROP,color:"#ff4400"};var aB=new BMap.PointCollection(aC,az);aB.addEventListener("mouseover",function(aF){});aB.addEventListener("click",function(aF){aB.clear();i=true;an.centerAndZoom(aF.point,18)});an.addOverlay(aB)}else{alert("对不起，目前地址只支持chrome、safari、IE8+以上浏览器哦")}}else{var aE=0;$.each(result,function(aG){if(aw==reqPointSign){var aI=this.areastat;var aF=new BMap.Point(this.longitude,this.latitude);var aH=new BMap.Point(this.orderlongitude,this.orderlatitude);if(this.isstat==undefined){aE=0}else{if(this.isstat==1&&aI==1){aF=aH}aE=this.isstat}L(aF,aH,aI,aE,aG)}})}}else{if(aD.code==1){if(B){B=false;setTimeout(function(){an.panTo(D)},100)}}}y=true;f=true};var ay=null;if(av==1&&ar==1&&W!=null){ay=W}else{if(av==2&&ar==1&&Z!=null){ay=Z}}if(ay==null){t(H,o.action,"level="+(o.level==1?2:o.level)+"&lng1="+o.lng1+"&lat1="+o.lat1+"&lng2="+o.lng2+"&lat2="+o.lat2+"&keywords="+o.keywords+"&querytype="+o.querytype+"&fidx="+o.fidx+"&eidx="+o.eidx+"&iscount="+o.iscount,ac)}else{ac(ay)}};var L=function(aD,az,ay,aA,aB){if(ay==1||o.level==4||(ay>1&&aA==0)){var ac={position:aD,offset:new BMap.Size(-30,-23)};var aC=new BMap.Label('<span class="z-font-wryh">确认地址<span style="color:#F60; margin:0 3px;">'+ay+"</span>个</span>",ac);aC.setStyle({color:"#666",fontSize:"12px",height:"20px",lineHeight:"20px",fontFamily:"宋体",borderRadius:"3px",border:"1px solid #22aaff",padding:"0 5px",background:"#D9F0F9"});aC.setZIndex(9999);var aF=new BMap.Icon("http://skin.1yyg.com/map/images/marker.png",new BMap.Size(27,30),{anchor:new BMap.Size(13,15)});var av=new BMap.Marker(aD,{icon:aF,offset:new BMap.Size(3,-12)});av.setZIndex(0);an.addOverlay(av);if(an.getZoom()>=14||r){az=aD}var ax='<div class="win_loading"><img src="http://skin.1yyg.com/images/goods_loading2.gif?v=140820" />正在努力加载...</div>';var at=new BMap.InfoWindow(ax,{enableMessage:false});at.setWidth(300);var ar=new BMap.Icon("http://skin.1yyg.com/map/images/markerover.png",new BMap.Size(29,33),{anchor:new BMap.Size(14,16)});av.addEventListener("mouseover",function(){this.setZIndex(50);if(!at.isOpen()){this.setLabel(aC);this.setIcon(ar)}});av.addEventListener("mouseout",function(){this.setZIndex(0);if(this.getLabel()!=null){this.getLabel().remove()}if(!at.isOpen()){this.setIcon(aF)}});at.addEventListener("open",function(){if(x!=null){clearTimeout(x);x=null}else{y=false;f=false;x=setTimeout(function(){y=true;f=true},1000)}av.setIcon(ar)});at.addEventListener("close",function(){av.setIcon(aF)});av.addEventListener("click",function(){o.iscount=1;o.fidx=1;o.eidx=3;this.openInfoWindow(at);if(C.lng==az.lng&&C.lat==az.lat){at.setContent(u);ai(az,av);if(x!=null){clearTimeout(x);x=null}y=false;f=false;x=setTimeout(function(){y=true;f=true},1000);return}C=az;t(H,"getOrderDetailByPoint","lng="+az.lng+"&lat="+az.lat+"&keywords="+o.keywords+"&querytype="+o.querytype+"&fidx="+o.fidx+"&eidx="+o.eidx+"&iscount="+o.iscount,function(aJ){if(aJ.code==0){var aH=aJ.result;var aI=aJ.count;I=aH[0].useraddress;ax='<div class="m_boxCon"><div class="m_title gray6"><b>'+I+'</b></div><div id="markerBox" class="m_info '+((E==1||E==2)?"un_blockCon":"blockCon")+'"><ul>';for(var aG=0;aG<aI;aG++){if(aG>1){break}if(E==1||E==2){ax+='<li><p class="myLogo"><a href="http://u.1yyg.com/'+aH[aG].userweb+'" target="_blank"><img src="http://faceimg.1yyg.com/UserFace/'+aH[aG].userphoto+'" /><s></s></a></p><dl><dt class="pro_name"><a href="http://www.1yyg.com/lottery/'+aH[aG].ordercodeid+'.html" target="_blank" title="'+aH[aG].codegoodssname+'">(第'+aH[aG].codeperiod+"云)"+aH[aG].codegoodssname+'</a></dt><dd>获得者：<a href="http://u.1yyg.com/'+aH[aG].userweb+'" class="blue" target="_blank" title="'+aH[aG].username+'">'+aH[aG].username+"</a></dd><dd>云购：<em>"+aH[aG].buyNum+"</em>人次</dd></dl></li>"}else{ax+='<li><a href="http://www.1yyg.com/lottery/'+aH[aG].ordercodeid+'.html" target="_blank"><p><img src="http://goodsimg.1yyg.com/GoodsPic/pic-200-200/'+aH[aG].goodspic+'"></p></a><dl><dt class="pro_name"><a href="http://www.1yyg.com/lottery/'+aH[aG].ordercodeid+'.html" target="_blank" title="'+aH[aG].codegoodssname+'">(第'+aH[aG].codeperiod+"云)"+aH[aG].codegoodssname+"</a></dt><dd>商品价值：￥"+aH[aG].codequantity+"</dd><dd>云购：<em>"+aH[aG].buyNum+"</em>人次</dd></dl></li>"}}ax+="</ul></div>";if(aI>2){ax+='<div class="m_more gray9">此位置已确认地址<em class="orange">'+aI+'</em>个，<a id="showMore" href="javascript:void(0);" class="gray9">查看更多>></a></div>'}ax+="</div>"}u=ax;at.setContent(ax);if(x!=null){clearTimeout(x);x=null}y=false;f=false;x=setTimeout(function(){y=true;f=true},1000);$("#markerBox").find("li").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});ai(az,av)})})}else{var au=ay;mouseoverTxt=az.lng+","+az.lat;var aw=new M(aD,au,mouseoverTxt,aB);var aE=ab(aD)||o.level<=2;if(aE){an.addOverlay(aw)}else{an.removeOverlay(aw)}}};var O=0;getOrderNextPageFun=function(ac){var ar=p;o.fidx=(ac-1)*9+1;o.eidx=ac*9;$("#loading").show();ar.find(".m_info").children("ul").empty();t(H,"getOrderDetailByPoint","lng="+n.lng+"&lat="+n.lat+"&keywords="+o.keywords+"&querytype="+o.querytype+"&fidx="+o.fidx+"&eidx="+o.eidx+"&iscount="+o.iscount,function(ay){if(ay.code==0){$("#loading").hide();var aw=ay.result;if(o.iscount==1){O=ay.count;o.iscount=0}if(O<=4){p.css("height","250px")}else{if(O>6){p.css("width","882px").css("height",O>9?400:360+"px")}}var az=($(window).width()-p.width())/2;var at=($(window).height()-p.height())/2;p.css({left:az+"px",top:at+"px"});var av="";for(var au=0;au<aw.length;au++){if(E==1||E==2){av+='<li><p><a href="http://u.1yyg.com/'+aw[au].userweb+'" target="_blank"><img src="http://faceimg.1yyg.com/UserFace/'+aw[au].userphoto+'" /><s></s></a></p><dl><dt class="pro_name"><a href="http://www.1yyg.com/lottery/'+aw[au].ordercodeid+'.html" target="_blank" title="'+aw[au].codegoodssname+'">(第'+aw[au].codeperiod+"云)"+aw[au].codegoodssname+'</a></dt><dd>获得者：<a href="http://u.1yyg.com/'+aw[au].userweb+'" class="blue" target="_blank" title="'+aw[au].username+'">'+aw[au].username+"</a></dd><dd>云购：<em>"+aw[au].buyNum+"</em>人次</dd></dl></li>"}else{av+='<li><a href="http://www.1yyg.com/lottery/'+aw[au].ordercodeid+'.html" target="_blank"><p><img src="http://goodsimg.1yyg.com/GoodsPic/pic-200-200/'+aw[au].goodspic+'"></p></a><dl><dt class="pro_name"><a href="http://www.1yyg.com/lottery/'+aw[au].ordercodeid+'.html" target="_blank" title="'+aw[au].codegoodssname+'">(第'+aw[au].codeperiod+"云)"+aw[au].codegoodssname+"</a></dt><dd>商品价值：￥"+aw[au].codequantity+"</dd><dd>云购：<em>"+aw[au].buyNum+"</em>人次</dd></dl></li>"}}$("#mTitle").html(I);$("#orderCount").html(O);if(E==3){ar.find(".m_info").removeClass("un_blockCon").addClass("blockCon")}else{ar.find(".m_info").removeClass("blockCon").addClass("un_blockCon")}ar.find(".m_info").children("ul").html(av);ar.find(".m_info ul").children("li").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});if(O>9){var ax=K(O,9,ac,5,"getOrderNextPageFun");ar.children(".m_page").remove();ar.append(ax)}else{ar.children(".m_info").next("div.m_page").remove()}}})};var ai=function(ar,ac){$("#showMore").unbind("click").bind("click",function(){ac.closeInfoWindow();var at=$(window).width();var av=$(window).height();var au=$(document.body).height()+12;b.css({width:at<1000?1000:at,height:av>au?av:au});b.show();if(n.lng==ar.lng&&n.lat==ar.lat){p.show()}else{p.css("width","585px").css("height","360px");$("#loading").show();p.show();n=ar;o.iscount=1;getOrderNextPageFun(1)}});$("#moreClose").bind("click",function(){p.hide();b.hide();o.iscount=0})};function M(ac,at,ar,au){this._point=ac;this._text=at;this._overText=ar;this._zIndex=au}M.prototype=new BMap.Overlay();M.prototype.initialize=function(av){this._map=av;var aw=this._div=document.createElement("div");aw.style.position="absolute";aw.style.zIndex=BMap.Overlay.getZIndex(this._point.lat);aw.setAttribute("lng",this._point.lng);aw.setAttribute("lat",this._point.lat);var ar=this._overText.split(",");aw.setAttribute("ordlng",ar[0]);aw.setAttribute("ordlat",ar[1]);aw.setAttribute("zIndex",this._zIndex);aw.style.backgroundColor="#EE5D5B";aw.style.border="1px solid #BC3B3A";aw.style.borderRadius="5px";aw.style.padding="2px 8px";aw.style.height="18px";var ac=this._text.toString().length*7;aw.style.width=ac+"px";aw.style.fontSize="12px",aw.style.lineHeight="18px";aw.style.fontWeight="bold";aw.style.fontFamily="arial";aw.style.color="white";aw.style.whiteSpace="nowrap";aw.style.MozUserSelect="none";aw.style.zIndex=this._zIndex;aw.appendChild(document.createTextNode(this._text));var at=this;var au=this._arrow=document.createElement("div");au.style.background="url(http://skin.1yyg.com/map/images/label.png) no-repeat";au.style.position="absolute";au.style.width="11px";au.style.height="10px";au.style.top="22px";au.style.left=parseInt((ac+6)/2)+"px";au.style.overflow="hidden";aw.appendChild(au);aw.onmouseover=function(){this.style.backgroundColor="#22aaff";this.style.borderColor="#22aaff";this.style.cursor="pointer";this.style.zIndex="9988";au.style.backgroundPosition="0px -20px"};aw.onmouseout=function(){this.style.backgroundColor="#EE5D5B";this.style.borderColor="#BC3B3A";this.style.zIndex=this.getAttribute("zIndex");au.style.backgroundPosition="0px 0px"};aw.onclick=function(){var ax=new BMap.Point(this.getAttribute("lng"),this.getAttribute("lat"));var aA=av.getZoom();var az=false;var ay;if(aA>=14){ay=16;az=true}else{if(aA>=12){ay=14;az=true}else{if(aA>=7){ay=12;az=true}else{if(aA>=5){ay=7;az=true}}}}if(az){av.centerAndZoom(ax,ay);if(aA>=7){B=true;D=new BMap.Point(this.getAttribute("ordlng"),this.getAttribute("ordlat"))}}};av.getPanes().labelPane.appendChild(aw);return aw};M.prototype.draw=function(){var ar=this._map;var ac=ar.pointToOverlayPixel(this._point);this._div.style.left=ac.x-2-parseInt(this._arrow.style.left)+"px";this._div.style.top=ac.y-32+"px"};var Y=function(at){an.clearOverlays();for(var ar=0;ar<at.length;ar++){var ac=ab(at[ar].getPosition());if(ac==true){an.addOverlay(at[ar])}else{an.removeOverlay(at[ar])}}};var ab=function(ar){var at=an.getBounds();var ac=at.getSouthWest();var au=at.getNorthEast();return((ar.lng>=ac.lng&&ar.lng<=au.lng)&&(ar.lat>=ac.lat&&ar.lat<=au.lat))};var af=function(){j.find("div.m_sort").find("a").each(function(){$(this).unbind("click").bind("click",function(){if(A){return}$(this).addClass("hover").siblings().removeClass("hover");var ac=$(this).attr("sortid");var ar=$(this).attr("title");RGFun.changeSortFun(ac,ar)})})};af();var U;getGoodsListBySortIDFun=function(){U=$("div.m_searchTo");var ac=0;var av=4;var aw=1;var au={action:"getListBySortID",keyword:"",sortID:0,sortName:"",FIdx:1,EIdx:av,isCount:1};var at=function(){return"keyword="+au.keyword+"&sortID="+au.sortID+"&FIdx="+au.FIdx+"&EIdx="+au.EIdx+"&isCount="+au.isCount};var ar=function(){if(A){return}A=true;j.find("div.m_page").remove();var ax=U.children(".m_loading");ax.css("display","").siblings().css("display","none");U.children("span").show();j.find("span.gray6").remove();t(H,au.action,at(),function(aB){if(aB.code==0){if(au.isCount==1){ac=aB.count;au.isCount=0}var ay=aB.result;ax.css("display","none").siblings().css("display","");if(au.sortID==0){U.children("span").show().html('共找到<em class="orange">'+ac+'</em>个有关“<b class="orange">'+au.sortName+"</b>”的商品")}else{U.children("span").show().html('共找到<em class="orange">'+ac+'</em>个分类为“<b class="orange">'+au.sortName+"</b>”的商品")}var az="";$.each(ay,function(){az+="<li goodsID="+this.goodsID+'><a href="javascript:void(0);"><img src="http://goodsimg.1yyg.com/GoodsPic/pic-200-200/'+this.goodsPic+'" /><dl><dt>'+this.goodsSName+'</dt> <dd class="gray9">已确认地址：<em class="blue">'+this.orderTrueTotal+"</em></dd></dl></a></li>"});U.find("ul").html(az);U.find("li").each(function(){$(this).bind("click",function(){$(this).addClass("hover").siblings().removeClass("hover");var aC=$(this).attr("goodsID");am(aC)})});if(ac>av){var aA=K(ac,av,aw,3,"RGFun.getNextPageFun");j.append(aA);j.find("div.m_page").css("width","256px")}else{j.find("div.m_page").remove()}}else{if(au.sortID==0){U.html('<span class="gray6"><i></i>未找到有关“<b class="orange">'+au.sortName+"</b>”的商品</span><ul></ul>")}else{U.html('<span class="gray6"><i></i>未找到分类“<b class="orange">'+au.sortName+"</b>”的商品</span><ul></ul>")}}A=false})};this.changeSortFun=function(ax,ay){au.action="getListBySortID";au.keyword="";au.sortID=ax;ac=0;aw=1;au.sortName=ay;au.FIdx=1;au.EIdx=av;au.isCount=1;q.val("");ar()};this.changeSearch=function(ax){au.action="getGoodsByKeyword";au.keyword=ax;au.sortID=0;au.sortName=q.val();au.FIdx=1;au.EIdx=av;aw=1;au.isCount=1;j.find("div.m_sort").find("a").removeClass("hover");ar()};this.getNextPageFun=function(ax){aw=ax;au.FIdx=(aw-1)*av+1;au.EIdx=aw*av;au.isCount=aw>0?0:1;ar()}};RGFun=new getGoodsListBySortIDFun();var am=function(ac){o.keywords=ac;o.level=1;o.querytype=1;v=false;r=false;a="getAreaGoodsByGoodsid";if(an.getZoom()!=5){an.centerAndZoom(new BMap.Point(116.404,39.915),5)}else{o.action=a;V()}};var N=function(ac){ac.unbind("focus").bind("focus",function(){$(this).css("color","#666")}).keydown(function(ar){if(13==((window.event)?event.keyCode:ar.keyCode)){ak();T(false)}})};N(q);N(g);var al=new BMap.Autocomplete({input:"keyword",location:an});g.focus();var ah=function(at){function ar(){_MoveCount=6;v=true;r=false;o.querytype=0;a="getAreastatByLevel";V()}var ac=new BMap.LocalSearch(an,{renderOptions:{map:an},onMarkersSet:function(av){if(av!=null&&av.length>0){for(var au=0;au<av.length;au++){av[au].marker.remove()}}},onSearchComplete:ar});ac.search(at)};var ag;var X=function(){ag=$("div.name_search");var au=4;var ac=0;var aw=1;var at={action:"",type:0,keyword:"",FIdx:1,EIdx:au,isCount:1,lng1:"116.404",lat1:"39.915",lng2:"116.404",lat2:"39.915"};var ar=function(){return"keyword="+encodeURIComponent(at.keyword.replace(/(\/)/g,""))+"&FIdx="+at.FIdx+"&EIdx="+at.EIdx+"&isCount="+at.isCount+"&lng1="+at.lng1+"&lat1="+at.lat1+"&lng2="+at.lng2+"&lat2="+at.lat2};var av=function(){if(A){return}A=true;ag.children(".m_loading").show();j.children("div.m_page").remove();t(H,at.action,ar(),function(aA){var ay="";if(aA.code==0){if(at.isCount==1){ac=aA.count;at.isCount=0}var ax=aA.result;$.each(ax,function(){ay+="<li userid="+this.orderuserid+">";ay+='<p><a href="http://u.1yyg.com/'+this.userweb+'" target="_blank" class="blue"><img src="http://faceimg.1yyg.com/UserFace/'+this.userphoto+'" /><s></s></a></p><dl class="gray9"><dt><a href="http://u.1yyg.com/'+this.userweb+'" target="_blank" class="blue" title="'+this.username+'">'+this.username+'</a></dt><dd class="class-icon'+this.gradeico+'"><s></s>'+this.grade+"</dd>";if(this.orderTotal>0){ay+='<dd>共获得商品：<em class="blue">'+this.orderTotal+'</em>个</dd><dd>已确认地址：<em class="blue">'+this.orderTrueTotal+"</em>个</dd>"}else{ay+="<dd>还未获得商品</dd>"}ay+="</dl></li>"});ag.children(".m_loading").hide();ag.children("ul").html(ay);A=false;ag.find("li").each(function(){var aB=$(this);if(ac==1){setTimeout(function(){var aC=aB.attr("userid");ap(aC);aB.addClass("hover")},800)}else{aB.bind("click",function(){aB.hover(function(){aB.addClass("hover")},function(){aB.removeClass("hover")});var aC=aB.attr("userid");ap(aC);aB.addClass("hover").siblings().removeClass("hover")})}});if(ac>au){var az=K(ac,au,aw,3,"RUFun.getNextPageFun");ag.append(az)}else{ag.next("div.m_page").remove()}}else{ay='<h4 class="gray6">搜索结果</h4>';ay+='<h5 class="gray6"><i></i>未找到相关结果</h5>';ag.html(ay);A=false}})};this.searchUsersFun=function(ax){at.type=0;at.action="getUserByKeywords";at.keyword=ax;at.FIdx=1;at.EIdx=au;at.isCount=1;aw=1;av()};this.searchAddressFun=function(){var ay=an.getBounds();var az=ay.getSouthWest();var ax=ay.getNorthEast();at.lng1=az.lng;at.lat1=az.lat;at.lng2=ax.lng;at.lat2=ax.lat;at.type=1;at.action="getUserInfoByLonLat";at.FIdx=1;at.EIdx=au;at.isCount=1;aw=1;av()};this.getNextPageFun=function(ax){aw=ax;at.FIdx=(aw-1)*au+1;at.EIdx=aw*au;at.isCount=aw>1?0:1;av()}};RUFun=new X();var ap=function(ac){o.keywords=ac;o.level=1;o.querytype=2;v=false;r=true;a="getOrdersByUserID";if(an.getZoom()!=5){an.centerAndZoom(new BMap.Point(116.404,39.915),5)}else{o.action=a;V()}};$(".m_search .m_type").children("a").each(function(ac){$(this).unbind("click").bind("click",function(){p.hide();var ar=$("#liNav");E=ac+1;$(this).addClass("hover").siblings().removeClass("hover");if(E==1){g.show().focus().val("");q.hide();j.css("right","-265px");c.hide();ar.html(s)}else{q.show().focus().val("");g.hide();if(c.css("display")=="none"){j.css("right","-265px");c.addClass("expand2").show()}if(E==2){ar.html('<a href="javascript:void(0);" title="智能手机">智能手机</a><a href="javascript:void(0);" title="3G手机">3G手机</a><a href="javascript:void(0);" title="宝马">宝马</a><a href="javascript:void(0);" title="单反">单反</a>')}else{ar.html("")}}ao()})});var ao=function(){$("#liNav").children("a").each(function(){$(this).unbind("click").bind("click",function(){var ac=$(this).attr("title");if(E==1){al.setInputValue(ac)}else{q.val(ac)}T(false);ak()})})};ao();$(".orangeBtn").bind("click",function(){A=false;an.clearOverlays();T(false);ak()});var ak=function(){p.hide();var ac=q.val();j.find("div.searchContent").html('<div class="name_search"><h4 class="gray6">搜索结果</h4><div class="m_loading" style="display: none;">正在努力加载中...</div><ul></ul></div>');ag=$("div.name_search");switch(E){case 1:ac=g.val();if(ac==""){g.focus()}ah(ac);break;case 2:j.find("div.searchContent").html(e);U=$("div.m_searchTo");af();if(ac==""){U.append('<span class="gray6"><i></i>查询商品名称不能为空</span>');j.find("div.m_page").remove();q.focus();return}RGFun.changeSearch(ac);break;case 3:if(ac==""){ag.html('<h4 class="gray6">搜索结果</h4><h5 class="gray6"><i></i>查询昵称不能为空</h5>');j.find("div.m_page").remove();q.focus();return}RUFun.searchUsersFun(ac);break}};$(window).resize(function(){l();if(b.css("display")=="block"){var ac=$(window).width();var au=$(window).height();var at=$(document.body).height()+12;b.css({width:ac<1000?1000:ac,height:au>at?au:at});var av=($(window).width()-p.width())/2;var ar=($(window).height()-p.height())/2;p.css({left:av+"px",top:ar+"px"})}});var K=function(aw,av,ay,aA,az){var ar=1,ax=1,au=1;var ac="";ar=parseInt(aw/av);if(aw%av>0){ar++}if(ar<1){ar=1}ac+='<div class="m_page">';if(aw>0){ax=1;while(ax+aA<ar+1&&ax+aA<ay+2){ax+=aA-2}au=ax+aA-1;if(au>ar){au=ar}if(ay==1){ac+='<a href="javascript:;" title="上一页" class="m_page_pre m_nopage_pre"></a>'}else{ac+='<a title="上一页" class="m_page_pre" href="javascript:'+az+"("+(ay-1)+')"></a>'}if(ax>1){ac+='<a href="javascript:'+az+'(1)" class="m_page_num">1</a>';ac+=ay>3?"<span>...</span>":""}for(var at=ax;at<=au;at++){if(at!=ay){ac+='<a href="javascript:'+az+"("+at+')" class="m_page_num">'+at+"</a>"}else{ac+='<a href="javascript:;" class="m_page_current">'+at+"</a>"}}if(au<ar){ac+=ay<ar-2?"<span>...</span>":"";ac+='<a href="javascript:'+az+"("+ar+')" class="m_page_num">'+ar+"</a>"}if(ay<ar){ac+='<a title="下一页" class="m_page_next" href="javascript:'+az+"("+(ay+1)+')"></a>'}else{ac+='<a title="下一页" class="m_page_pre m_nopage_next"></a>'}}ac+="</div>";return ac}};var G=function(){function J(){var K=new Date();return K.getFullYear().toString().substring(2,4)+"."+(K.getMonth()+1)+"."+K.getDate()}Base.getScript("http://api.map.baidu.com/getscript?v=2.0&ak=a9RbDTEvcc6AGiORrcOsn9GX&services=&t="+J(),k)};Base.getScript("http://skin.1yyg.com/JS/Comm.js?t=20140904",G)});