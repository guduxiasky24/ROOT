var isLoadScrollJs=false;var _IsLoadLoginJS=false;var PagePOPLoginOK=null;$.fn.miniCollectTool=function(b){var h=$(this);var d=$("#colect_box");var l=$("#colect_shower");var f=33;var j=$(window).height();var i=true;var p=$("#ulRToolList").find(".f-attention");p.addClass("cart-hover").find("b").show();if(h.attr("isShowed")=="1"){return}var n=37;if(/(msie\s|trident.*rv:)([\w.]+)/.test(navigator.userAgent.toLowerCase())&&parseInt($.browser.version)==6){n=36}var o=j-f-8;d.height(o).show();var m=(o-50)/2;var a=h.attr("isChanged")!="0";if(a){l.html('<div class="loading-2015 clrfix" style="padding-top:'+m+'px"><em></em></div>')}h.css({height:j-2}).show().stop().animate({right:n},{duration:400,queue:false,complete:function(){}}).attr("isShowed","1");if(!a){return}var c=$www+"/products/";var k=$img;var q=true;var e=function(){$.get("/user/getCollectGoodsList.action",{pageNo:1,pageSize:10000},function(F){var B=F;if(B.length>0){l.empty();var w=F;var r=w.length;for(var x=0;x<r;x++){var z=parseInt(w[x].spellbuyCount);var D=parseInt(w[x].productPrice);var s=parseInt(D-z);var E=formatFloat((z*100)/D);E=z>0&&E<1?1:E;var y='<ul><li><a target="_blank" title="'+w[x].productName+'" href="'+c+w[x].productId+'.html"><img src="'+k+w[x].headImage+'"></a></li><li name="info" class="att-ing">'+(w[x].status==1?'\u7b2c<em class="orange">'+w[x].productPeriod+'</em>\u671f<i class="dotting"></i>':"<p>\u5df2\u7ed3\u675f</p>")+"</li>"+(w[x].status==1?'<li name="info" class="att-show" style="display:none;"><dl class="m-progress" title="\u5b8c\u6210'+E+'%"><dt><b style="width:'+E+'%;"></b></dt></dl><span class="att-btn"><a class="att-add" href="javascript:;" codeID="'+w[x].productId+'">\u52a0\u5165\u8d2d\u7269\u8f66</a></span><a goodsID="'+w[x].spellbuyProductId+'" title="\u5220\u9664" href="javascript:;" class="att-close"></a></li>':'<li name="info" class="att-show" style="display:none;"><p>\u5df2\u7ed3\u675f</p><a goodsID="'+w[x].spellbuyProductId+'" title="\u5220\u9664" href="javascript:;" class="att-close"></a></li>')+"</ul>";var A=$(y);if(w[x].status==1){A.find("a.att-add").click(function(){var H=$(this);var G=H.attr("codeID");$.ajax({url:"/list/isStatus.action",data:"id="+G,success:function(data){if(data=="false"){e()}else{var count=data;var codeid=G;var json=getCookie("products");if(json==null||json==""){var val="[{'pId':"+codeid+",'num':"+1+"}]";SetCookieByExpires("products",val,1)}else{var flag=false;json=eval("("+json+")");$.each(json,function(n,value){if(codeid==value.pId){value.num=(parseInt(value.num)+1);if(parseInt(value.num)>count){value.num=count}flag=true}});if(!flag){json.push({pId:+codeid,num:1})}json=JSON.stringify(json);SetCookieByExpires("products",json,1)}_IsCartChanged=true;var K=data>0?"\u52a0\u5165\u6210\u529f":"\u53c2\u4e0e\u4eba\u6b21\u5df2\u8fbe\u4e0a\u9650";var J=data>0?"":"att-prompt-icon";var L=H.parent().parent().parent();L.addClass("hover").append('<div class="att-add-success"><cite><i class="transparent-png '+J+'"></i>'+K+"</cite><span></span></div>");setTimeout(function(){L.removeClass("hover").find("div.att-add-success").remove()},1000)}}});return false})}A.find("a.att-close").click(function(){var G=$(this).attr("goodsID");$.ajax({url:"/user/delCollectGoods.action",data:"id="+G,success:function(H){if(H==0){e()}else{if(H==-1){location.reload()}else{FailDialog("\u62b1\u6b49\uff0c\u5220\u9664\u5931\u8d25!")}}}});return false});A.hover(function(){$(this).children('li[name="info"]').eq(0).hide().next().css("display","block")},function(){$(this).children('li[name="info"]').eq(0).css("display","block").next().hide()});l.append(A)}var v=122;var C=d.height();var u=C%v==0?C/v:parseInt(C/v)-1;l.css("top","0px");d.children("div.iscroll-drap-parent").remove();if(r>2*u){var t=function(){isLoadScrollJs=true;new iScroll("colect_box");d.hover(function(){d.children("div.iscroll-drap-parent").fadeIn("slow")},function(){d.children("div.iscroll-drap-parent").fadeOut("slow")});if(q){d.children("div.iscroll-drap-parent").hide()}};if(!isLoadScrollJs){$.getScript("/js/iscroll.js?date=150203",t)}else{t()}}q=false;i=true;h.attr("isChanged","0")}else{h.stop().animate({right:"-240px"},{duration:400,queue:false,complete:function(){p.removeClass("cart-hover").find("b").hide();h.attr("isShowed","0")}});h.attr("isChanged","1")}})};if(b){e()}else{l.html('<div class="no-login-wrapper" style="padding-top:'+m+'px"><div class="gth-icon transparent-png"></div><p class="ng-see-mycord">\u8bf7\u60a8<a id="btnCltLogin" href="javascript:;">\u767b\u5f55</a>\u540e\u67e5\u770b\u5173\u6ce8\u8bb0\u5f55\uff01</p></div>');l.find("#btnCltLogin").click(function(){var r=function(){i=false;var s=new popLogin();PagePOPLoginOK=function(){e();s.hide()};s.show()};if(_IsLoadLoginJS){r()}else{$.getScript("/js/poplogin.js?date=20140814",function(){_IsLoadLoginJS=true;r()})}return false})}var g=function(r){if(r&&r.stopPropagation){r.stopPropagation()}else{window.event.cancelBubble=true}};$("body").click(function(r){if(i){r=r||window.event;g(r);h.stop().animate({right:-240},{duration:500,queue:false,complete:function(){p.removeClass("cart-hover").find("b").hide();h.attr("isShowed","0")}})}});h.click(function(r){r=r||window.event;g(r)})};
