$(function(){var J=$skin;var N=$("#username");var U=$("#pwd");var M=$("#j-tips-wrap");var F=null;var O=null;var R=false;var ab=/\w+(@{1})$/i,W=["qq.com","sina.com","163.com","126.com","139.com","sohu.com"],C="",D=0;var S=function(b){var a=function(d,c,f){var e=new RegExp(c,"g");return d.replace(e,f)};var b=escape(b);b=a(b,"\\+","%2B");b=a(b,"/","%2F");return b};var aa=function(b){var a=/^1\d{10}$/;if(!a.exec(b)){return false}else{return true}};var ac=function(a){var b=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;if(b.test(a)){return true}return false};var L=function(b){var a=/^[\S]{6,20}$/;if(!a.exec(b)){return false}return true};var B=function(){try{if(/(msie\s|trident.*rv:)([\w.]+)/.test(navigator.userAgent.toLowerCase())&&parseInt($.browser.version)==6){$.getScript(J+"/js/iepng.js?date=20150215",function(){if(EvPNG!=null&&EvPNG!=undefined){EvPNG.fix(".transparent-png")}})}}catch(a){}};function A(a,b){document.cookie=a+"="+escape(b)+";id=1ypg;path=/;domain="+$domain}function H(b,d,a){var c=a;var e=new Date();e.setTime(e.getTime()+c*24*60*60*1000);document.cookie=b+"="+escape(d)+";id=1ypg;path=/;expires="+e.toGMTString()+";domain="+$domain}function V(b){var a=document.cookie.match(new RegExp("(^| )"+b+"=([^;]*)(;|$)"));if(a!=null){return unescape(a[2])}return null}var I=null;var E=null;E=setInterval(function(){if(N.val()!=""){if(!aa(N.val())&&!ac(N.val())){N.val("");N.siblings("em").show();U.val("");U.siblings("em").show();U.blur()}else{N.siblings("em").hide()}}if(U.val()!=""){if(!L(U.val())){U.val("");if(N.val()==""){U.blur()}U.siblings("em").show()}else{U.siblings("em").hide()}}},200);var X=function(){if(E!=null){clearInterval(E);E=null;if(I!=null){clearTimeout(I);I=null}}};I=setTimeout(function(){X()},5000);var Q=function(a,b){if(a){$(a).parent().addClass("enter-focus")}$("#dd_error_msg").html('<i class="passport-icon transparent-png"></i>'+b).show(10,function(){B()});$("#btnSubmitLogin").removeClass("letter-noSpac").html("\u767b\u5f55");R=false};var Y=function(a){if(a){$(a).parent().removeClass("enter-focus")}$("#dd_error_msg").hide()};N.focus(function(){$(this).parent().addClass("enter-focus")}).blur(function(){if(E!=null){return}$(this).parent().removeClass("enter-focus");if($(this).val()==""){$(this).siblings("em").show();$(this).css("color","#bbbbbb");$("#dd_error_msg").hide();return}G.checkUserName(false)}).click(function(a){X();a=a||window.event;a.stopPropagation();if(M.children().length>0&&N.val().indexOf("@")!==-1){M.show()}}).keydown(function(){$(this).css("color","#333333");N.siblings("em").hide();$("#dd_error_msg").hide()});if(N.val()==""){N.siblings("em").bind("click",function(){N.focus()}).show()}N.keyup(function(h){h=h||window.event;h.stopPropagation();var c=this.value,j=0,k=0,i=W.length,d=h.keyCode,b="";if(ab.test(c)){for(;j<i;j++){C+="<li class='j-tips'>"+(c+W[j])+"</li>"}M.show().empty().html(C);C=""}else{if(c.indexOf("@")!==-1){var g=c.indexOf("@"),a=c.slice(0,g+1),e=c.slice(g+1);for(;k<i;k++){if(W[k].indexOf(e)!==-1){b+="<li class='j-tips'>"+(a+W[k])+"</li>"}}if(b!==""){M.show().empty().html(b)}else{M.hide();D=0}}else{D=0;M.hide()}}if(M.css("display")==="block"){var f=M.find("li");switch(d){case 13:if(D>0){N.val(f.eq(D-1).text().trim()).blur();M.hide();U.focus();D=0}break;case 40:D=D+1>f.length?1:D+1;f.removeClass("selected").eq(D-1).addClass("selected");break;case 38:D=D-1<1?f.length:D-1;f.removeClass("selected").eq(D-1).addClass("selected");break;default:break}}});M.click(function(b){b=b||window.event;b.stopPropagation();var a=b.target||b.srcElement;if(a.tagName.toLowerCase()==="li"){N.val($(a).text().trim()).blur();U.focus()}$(this).hide()});$(window).click(function(c){if(M.css("display")!=="block"){return}c=c||window.event;var a=c.target||c.srcElement,b=a.id.toLowerCase();if(b!=="j-tips-wrap"||b!=="username"){M.hide()}});U.focus(function(){$(this).parent().addClass("enter-focus");M.hide()}).blur(function(){if(E!=null){return}$(this).parent().removeClass("enter-focus");if($(this).val()==""){$(this).siblings("em").show();$(this).css("color","#bbbbbb");$("#dd_error_msg").hide();return}G.checkPwd(false)}).keydown(function(){$(this).css("color","#333333");$(this).siblings("em").hide();$("#dd_error_msg").hide()});if(U.val()==""){U.siblings("em").bind("click",function(){U.focus()}).show()}var K=function(){this.checkUserName=function(a){F=N.val().trim();if(F==""){if(a){N.focus()}Q(N,"\u8bf7\u8f93\u5165\u624b\u673a\u53f7\u6216\u90ae\u7bb1\u5730\u5740");return false}else{if(!aa(F)&&!ac(F)){if(a){N.focus()}Q(N,"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u6216\u90ae\u7bb1\u5730\u5740");return false}}Y(N);return true};this.checkPwd=function(a){O=U.val().trim();if(O==""){if(a){U.focus()}Q(U,"\u8bf7\u8f93\u5165\u767b\u5f55\u5bc6\u7801");return false}else{if(!L(O)){if(a){U.focus()}Q(U,"\u767b\u5f55\u5bc6\u7801\u4e3a6-20\u957f\u5ea6\u7684\u5b57\u7b26");return false}}Y(U);return true}};var G=new K();var P=function(){var b=V("loginUser");if(b!=null&&(aa(b)||ac(b))){N.siblings("em").hide();N.val(b);if(U.val()==""){U.focus()}}var a=function(){X();if(R){return}R=true;if(G.checkUserName(true)&&G.checkPwd(true)){$("#btnSubmitLogin").addClass("letter-noSpac").html("\u6b63\u5728\u767b\u5f55...");var c=function(e){var d=e;if(d=="userError"){Q(N,"\u6b64\u8d26\u53f7\u4e0d\u5b58\u5728\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165")}else{if(d=="pwdError"){Q(U,"\u767b\u5f55\u5bc6\u7801\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165")}else{if(d.userId){A("userId",d.userId);A("face",d.faceImg)}if(d.userName){A("userName",d.userName)}else{if(d.mail){A("userName",d.mail)}else{if(d.phone){A("userName",d.phone)}}}A("loginType",0);parent.POPLoginOK()}}H("loginUser",F,365)};$.post("/login/login.html",{userName:F,pwd:S(O)},c)}};$("#LoginForm").keydown(function(c){X();var d=(window.event)?event.keyCode:c.keyCode;if(d==32){return false}else{if(d==13){a()}}return true}).bind("click",function(){X()});$("#btnSubmitLogin").bind("click",function(){a()});if(N.val()==""){N.focus()}};QC.Login({btnId:"qq_login_btn",scope:"get_user_info,add_share",size:"B_M"},function(a,b){if(QC.Login.check()){QC.Login.getMe(function(d,c){$.ajax({url:"/register/authorizeIsExists.action",type:"POST",data:"openId="+encodeURIComponent(d.replace(/(\/)/g,"")),success:function(e){if(e=="true"){$.ajax({type:"POST",url:"/register/authorizeRegsiter.action",data:"userName="+encodeURIComponent(a.nickname.replace(/(\/)/g,""))+"&openId="+d+"&userFace="+a.figureurl_2,success:function(f){A("userId",f.userId);A("userName",f.userName);A("face",f.faceImg);A("loginType",2);window.location.href="/register/qqUserInfoAuth.html"}})}else{A("userId",e.userId);A("userName",e.userName);A("face",e.faceImg);A("loginType",2);window.location.href="/register/qqUserInfoAuth.html"}}})})}});var Z=false;var T=false;$("#wx_login_btn").click(function(){$.cookie("qFromUrl",$("#hidLoginForward").val());if(/(msie\s|trident.*rv:)([\w.]+)/.test(navigator.userAgent.toLowerCase())&&parseInt($.browser.version)==6){window.open("https://open.weixin.qq.com/connect/qrconnect?appid="+$("#hidWxAppID").val()+"&redirect_uri="+escape($www+"/qc_callback.html")+"&response_type=code&scope=snsapi_login&state=wx#wechat_redirect")}else{var a=$("#wxLogin");var b=$("#LoginForm");var e=$("#a_return",a);var c=function(){if(T){return}T=true;a.show();a.animate({right:0},{queue:false,duration:500,complete:function(){e.unbind("click").bind("click",function(){d()})}})};var d=function(){if(!T){return}T=false;a.animate({right:-390},{queue:false,duration:500,complete:function(){}})};var f=function(){if($("#p_code").html().length==0){var g=new WxLogin({id:"p_code",appid:$("#hidWxAppID").val(),scope:"snsapi_login",redirect_uri:escape("https://passport.1yyg.com/qcback.html"),state:"wx",style:"",href:"https://skin.1yyg.com/Passport/css/layout.css?date=0617"})}c()};if(Z){f()}else{$.getScript("https://res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js",function(){f();Z=true})}}});$.getScript(J+"/js/comm.js?date=20130123",P)});
