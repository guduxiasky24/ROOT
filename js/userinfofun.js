var _UserInfoCache=new Object();var _isExistUserCard=false;var _UserWebVal="";$.fn.ShowUserCard=function(){function E(c,d,b,a){$.getJSON(c+"/JPData?action="+d+"&"+b+"&fun=?",a)}var H=$www;var y=$(this);var L=y.attr("uweb");var Q=false;var I=false;var w=null;var N=0;var C=0;y.hover(function(a){Q=true;_UserWebVal=L;if(!I){I=true;setTimeout(R,500)}},function(){Q=false;z()}).mousemove(function(c){var a=c||window.event;var b=P(a);N=b.x;C=b.y});var P=function(a){if(a.pageX||a.pageY){return{x:a.pageX,y:a.pageY}}return{x:a.clientX+document.body.scrollLeft-document.body.clientLeft,y:a.clientY+document.body.scrollTop-document.body.clientTop}};var R=function(){if(_UserWebVal!=L||!Q){return}if(_UserInfoCache["u"+L]!=null&&_UserInfoCache["u"+L]!="undefined"){A(_UserInfoCache["u"+L])}else{J()}};var J=function(){E(H,"getUserInfo","userWeb="+L,function(a){if(a.code==0){var b=a.sign.reAjaxStr();if(b==""){a.sign="\u8fd9\u5bb6\u4f19\u5f88\u61d2\uff0c\u4ec0\u4e48\u4e5f\u6ca1\u7559\u4e0b\u3002"}else{a.sign=b}_UserInfoCache["u"+L]=a;A(a)}})};var D=function(a){var b='<div class="Member_Pop_img"><a href="'+H+"/u/"+a.userId+'.html"><img src="'+a.userFace+'" border="0" alt=""></a></div><div class="Member_Pop_info"><p class="Member_Pop_name"><a href="'+H+"/u/"+a.userId+'.html" class="blue" rel="nofollow">'+a.userName+'</a></p><p class="Member_Pop_class gray02"><span class="class-icon'+a.grade+'"><s></s>'+a.gradeName+"</span>";if(a.addr!=""){b+='<span class="address-icon"><s></s>'+a.addr+"</span>"}b+='</p><p class="Member_Pop_intro gray02">'+a.sign+'</p></div><div class="Member_Pop_but">';b+='<a href="javascript:void();" userName="'+a.userName+'" class="Member_Pop_letter"><i></i>\u53d1\u79c1\u4fe1</a>';if(a.isFriend!=1){b+='<a href="javascript:void();" class="Member_Pop_friend"><s></s>\u52a0\u597d\u53cb</a>'}else{b+='<a href="javascript:void();" class="Member_Pop_Has">\u5df2\u662f\u597d\u53cb</a>'}b+="</div>";return b};var A=function(b){if(!_isExistUserCard){$("body").append('<div id="divUserCard" class="Member_Pop"></div>');_isExistUserCard=true}w=$("#divUserCard");var d=D(b);w.html(d);w.unbind("mouseenter").unbind("mouseleave").hover(function(){Q=true;I=true},function(){Q=false;z()});w.find("a.Member_Pop_friend").click(function(){O();E("http://api.1yyg.com","logininfo","",function(g){var f=g.code;if(f==1){F()}else{if(f==0){CBLPageFun.checkUserLoginFunEx(F)}}});return false});w.find("a.Member_Pop_letter").click(function(){O();var f=$(this).attr("userName");G="\u5bf9 "+f+" \u8bf4\uff1a";E(H,"checkSendMsg","inceptUserWeb="+L,function(h){var g=h.code;if(g==10){CBLPageFun.checkUserLoginFunEx(B)}else{if(g==0){B()}else{if(g==1){if(h.num==-1){FailDialog("\u53ea\u6709TA\u7684\u597d\u53cb\u624d\u53ef\u4ee5\u53d1\u79c1\u4fe1\u7ed9TA\u54e6\uff01",300)}else{if(h.num==-2){FailDialog("TA\u62d2\u7edd\u4efb\u4f55\u4eba\u53d1\u79c1\u4fe1\u7ed9TA\u54e6\uff01",240)}}}else{if(g==2){FailDialog("\u4e0d\u80fd\u7ed9\u81ea\u5df1\u53d1\u79c1\u4fe1\u54e6\uff01",240)}else{FailDialog("\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01",240)}}}}});return false});var c=$(window).width();if(N+280>c){N=N-280}var e=document.documentElement.clientHeight;var a=M();if(C-a+140>e){C=C-140}N=N+4;C=C+8;w.css({left:N,top:C,zIndex:1024}).show()};var M=function(){var a=0;if(typeof window.pageYOffset!=typeof undefined){a=window.pageYOffset}else{if(typeof document.compatMode!=typeof undefined&&document.compatMode!="BackCompat"){a=document.documentElement.scrollTop}else{if(typeof document.body!=typeof undefined){a=document.body.scrollTop}}}return a};var O=function(){Q=false;I=false;$("#divUserCard").css({left:-300,top:-300}).html("").hide()};var z=function(){var a=function(){if(!Q){I=false;$("#divUserCard").css({left:-300,top:-300}).html("").hide()}};setTimeout(a,200)};var F=function(){E(H,"applyFriend","userWeb="+L,function(a){var b=a.code;if(b==10){_IsLogin=false;CBLPageFun.checkUserLoginFunEx(F)}else{if(b==1){OKDialog("\u7533\u8bf7\u6210\u529f\uff0c\u8bf7\u7b49\u5f85\u5bf9\u65b9\u901a\u8fc7\uff01",230)}else{if(b==2){FailDialog("TA\u5df2\u7ecf\u662f\u60a8\u7684\u597d\u53cb\uff01")}else{if(b==3){FailDialog("\u4e0d\u80fd\u52a0\u81ea\u5df1\u4e3a\u597d\u53cb\uff01")}else{if(b==-1){FailDialog("\u5bf9\u65b9\u62d2\u7edd\u52a0\u4e3a\u597d\u53cb\uff01")}else{if(b==-2){FailDialog("\u60a8\u4eec\u5df2\u662f\u597d\u53cb\u5173\u7cfb\uff01")}else{if(b==-4){FailDialog("\u60a8\u4eca\u5929\u7684\u597d\u53cb\u7533\u8bf7\u5df2\u8d85\u51fa\u9650\u6570\uff01")}else{FailDialog("\u7533\u8bf7\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01")}}}}}}}})};var K={action:"insertMsg",msgTouserWeb:L,msgContent:""};var G="";var x=function(a){if(K.msgContent==""){FailDialog("\u8bf7\u8f93\u5165\u79c1\u4fe1\u5185\u5bb9\uff01")}else{E(H,K.action,"msgTouserWeb="+K.msgTouserWeb+"&msgContent="+encodeURI(K.msgContent.replace("&"," ")),function(b){var c=b.code;if(c==10){location.reload()}else{if(c==1){a();OKDialog("\u53d1\u9001\u6210\u529f\uff01")}else{if(c==-1){FailDialog("\u53ea\u6709TA\u7684\u597d\u53cb\u624d\u53ef\u4ee5\u53d1\u79c1\u4fe1\u7ed9TA\u54e6\uff01",300)}else{if(c==2){FailDialog("TA\u62d2\u7edd\u4efb\u4f55\u4eba\u53d1\u79c1\u4fe1\u7ed9TA\u54e6\uff01",220)}else{FailDialog("\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01")}}}}})}};var B=function(){var a=function(){var g=$("#txtPrivateMsgEx");var c=function(h,l,j,i){if(h.prev("iframe").length>0){return null}var k=$('<iframe class="edit-iframe" hidefocus="true" frameborder="0" scrolling="no" src="about:blank"></iframe>');k.css({width:h.width(),height:h.height()}).attr("src","http://skin.1yyg.com/Editor/"+l+".htm?edit="+h.attr("id")+"&postdom="+i+(j==""?"":"&upurl="+j)+"");h.hide().before(k);k.ready(function(){});return k};var e=function(i){var h=c(i,"message","","btnPostMsgEx");this.GetHtml=function(){try{return h.get(0).contentWindow.GetHtml()}catch(j){return""}};this.remove=function(){h.remove();i.show()}};var f=function(){$.PageDialog.close()};var b=$('<input type="button" id="btnPostMsgEx" class="hidden" />');b.bind("click",function(){K.msgContent=d.GetHtml();x(f)});g.parent().append(b).show();var d=new e(g)};$.PageDialog('<textarea id="txtPrivateMsgEx" style="width:400px; height:160px; border:0px;"></textarea>',{title:G,W:410,H:200,ready:a})}};
