var PagePOPLoginOK=null;var skinDomain="http://skin.1yyg.com";$(document).ready(function(){var m=getPageDataArray();var h=function(){var a='<div class="z-popUp z-sold-out"><i class="z-arrows"></i>\u90e8\u5206\u5546\u54c1\u53c2\u4e0e\u4eba\u6b21\u5df2\u8fbe\u4e0a\u9650\uff01</div>';$.PageDialog(a,{W:258,H:65,close:false,autoClose:true})};if(m.tips=="1"){h()}var j="http://cart.1yyg.com";var i=function(){var a=$.cookie("_cartTips");if(a!="1"&&parseInt($("#hidTotalMoney").val())>100){$("#divTips").show()}else{$("#divTips").hide()}};var n=$("#divEmpty");var k=function(){if(n.length>0){var a="<b></b>"+($("#hidLogined").val()=="0"?'<span>\u5982\u679c\u60a8\u8fd8\u672a\u767b\u5f55\uff0c\u53ef\u80fd\u5bfc\u81f4\u8d2d\u7269\u8f66\u4e3a\u7a7a\uff0c\u8bf7<a href="https://passport.1yyg.com/login.html?forward=rego">\u9a6c\u4e0a\u767b\u5f55</a></span>':'<span>\u60a8\u7684\u8d2d\u7269\u8f66\u4e3a\u7a7a\uff01<a href="http://www.1yyg.com" title="\u7acb\u5373\u53bb\u60ca\u559c>>">\u7acb\u5373\u53bb\u60ca\u559c<em class="f-tran">>></em></a></span>');n.html(a)}else{n.empty()}};k();var l=function(){var g=true;var E=$("#divCartBox");var e=$("#dlCartList");var z=$("#pageDialog");var y=$("#iTotalMoney");var f=$("#btnGoPay");var D=parseInt($("#hidCartState").val());var C='<b class="z-comms"></b>';var a=function(q,s,r){var p="";switch(q){case"selGoodsState":p='<div class="z-popUp z-pop-box"><span class="gray3">\u90e8\u5206\u5546\u54c1\u5df2\u5931\u6548\uff0c\u7ee7\u7eed\u60ca\u559c\uff1f</span><a href="javascript:;" title="\u53d6\u6d88" class="z-btn-cancel">\u53d6\u6d88</a><a href="javascript:;" title="\u786e\u5b9a" class="z-btn-determine">\u786e\u5b9a</a></div>';var o=function(){z.find("a.z-btn-determine").click(function(){s();return false});z.find("a.z-btn-cancel").click(function(){GetJPData(j,"updateCartState","codeStr="+r,function(t){location.href=j+"/payment.do"});return false})};$.PageDialog(p,{W:410,H:170,close:true,autoClose:false,ready:o});break;case"allOutDate":p='<div class="z-popUp z-pop-box"><span class="gray3">\u60a8\u7684\u8d2d\u7269\u8f66\u4e2d\u6240\u6709\u5546\u54c1\u5df2\u5931\u6548\uff01</span><a href="javascript:;" title="\u53d6\u6d88" class="z-btn-cancel">\u53d6\u6d88</a><a href="javascript:;" title="\u6e05\u7a7a\u8d2d\u7269\u8f66\u5e76\u8fd4\u56de\u60ca\u559c" class="z-btn-determine">\u6e05\u7a7a\u8d2d\u7269\u8f66\u5e76\u8fd4\u56de\u60ca\u559c</a></div>';var o=function(){z.find("a.z-btn-cancel").click(function(){$.PageDialog.close();return false});z.find("a.z-btn-determine").click(function(){s();return false})};$.PageDialog(p,{W:512,H:197,close:true,autoClose:false,ready:o});break;case"delNone":p='<div class="z-popUp z-pop-box"><span class="gray3">\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u5546\u54c1\uff01</span><a href="javascript:;" title="\u786e\u5b9a" class="z-btn-determine">\u786e\u5b9a</a></div>';var o=function(){z.find("a.z-btn-determine").click(function(){$.PageDialog.close();return false})};$.PageDialog(p,{W:350,H:197,close:true,autoClose:false,ready:o});break;case"delCart":p='<div class="z-popUp z-pop-box"><span class="gray3">\u786e\u5b9a\u8981\u5220\u9664\u6240\u9009\u7684\u5546\u54c1\uff1f</span><a href="javascript:;" title="\u53d6\u6d88" class="z-btn-cancel">\u53d6\u6d88</a><a href="javascript:;" title="\u786e\u5b9a" class="z-btn-determine">\u786e\u5b9a</a></div>';var o=function(){z.find("a.z-btn-determine").click(function(){s();return false});z.find("a.z-btn-cancel").click(function(){$.PageDialog.close();return false})};$.PageDialog(p,{W:398,H:197,close:true,autoClose:false,ready:o});break;case"delCartOut":p='<div class="z-popUp z-pop-box"><span class="gray3">\u786e\u5b9a\u8981\u5220\u9664\u6240\u6709\u5931\u6548\u5546\u54c1\uff1f</span><a href="javascript:;" title="\u53d6\u6d88" class="z-btn-cancel">\u53d6\u6d88</a><a href="javascript:;" title="\u786e\u5b9a" class="z-btn-determine">\u786e\u5b9a</a></div>';var o=function(){z.find("a.z-btn-determine").click(function(){s();return false});z.find("a.z-btn-cancel").click(function(){$.PageDialog.close();return false})};$.PageDialog(p,{W:398,H:197,close:true,autoClose:false,ready:o});break;case"delCartS":p='<div class="z-popUp z-add-success"><i class="z-arrows"></i>\u5220\u9664\u6210\u529f\uff01</div>';$.PageDialog(p,{W:168,H:65,close:false,autoClose:true,autoTime:1000,submit:s});break;case"delCartF":p='<div class="z-popUp z-sold-out"><i class="z-arrows"></i>\u62b1\u6b49\uff0c\u5220\u9664\u5931\u8d25\uff01</div>';$.PageDialog(p,{W:180,H:65,close:false,autoClose:true,autoTime:1000,submit:s});break;case"buyNumErr":p='<div class="z-popUp z-sold-out"><i class="z-arrows"></i>\u5bf9\u4e0d\u8d77\uff0c\u8d2d\u4e70\u4eba\u6b21\u8f93\u5165\u6709\u8bef\uff01</div>';$.PageDialog(p,{W:258,H:65,close:false,autoClose:true});break;case"selEmpty":p='<div class="z-popUp z-sold-out"><i class="z-arrows"></i>\u5bf9\u4e0d\u8d77\uff0c\u8d2d\u7269\u8f66\u4e2d\u6ca1\u6709\u9009\u4e2d\u7684\u5546\u54c1\uff01</div>';$.PageDialog(p,{W:310,H:65,close:false,autoClose:true});break;case"goodsOff":p='<div class="z-popUp z-sold-out"><i class="z-arrows"></i>\u5df2\u6ee1\u5458\uff0c\u8bf7\u9009\u62e9\u4e0b\u4e00\u4e91\uff01</div>';$.PageDialog(p,{W:420,H:65,close:false,autoClose:true,submit:s});break;case"addCartS":p='<div class="z-popUp z-add-success"><i class="z-arrows"></i>\u6dfb\u52a0\u6210\u529f\uff01</div>';$.PageDialog(p,{W:168,H:65,close:false,autoClose:true,autoTime:1000,obj:r,oL:-60,oT:-50,ready:function(){$("#pageDialogBG").hide()},submit:s});break;case"addCartF":p='<div class="z-popUp z-sold-out"><i class="z-arrows"></i>\u62b1\u6b49\uff0c\u6dfb\u52a0\u5931\u8d25\uff01</div>';$.PageDialog(p,{W:180,H:65,close:false,autoClose:true,autoTime:1000,obj:r,oL:-60,oT:-50,ready:function(){$("#pageDialogBG").hide()},submit:s});break}};var c=function(){var o=0;$("input:text[name=num]").each(function(){var r=parseInt($(this).val());var s=$(this).parent().parent().parent();var p=$("p[class='ts']",s);var q=$("a[type='check']",s);if(q.find("b").length>0&&!isNaN(r)&&$(this).attr("outdate")!=1){o+=r}});y.html("\uffe5"+o+".00");$("#hidTotalMoney").val(o)};var G=function(){var o=true;e.find('a[type="check"]').each(function(){if(!$(this).find("b").length>0){o=false;return}});if(o){F.html(C)}else{F.html("")}};var A=function(o){if(o&&o.stopPropagation){o.stopPropagation()}else{window.event.cancelBubble=true}};$.fn.CartItemFun=function(){var p=$(this);var Y=parseInt(p.attr("codeid"));var x=p.find('a[type="check"]');x.click(function(){var I=$(this).find("b").length>0;if(I){$(this).html("")}else{$(this).html(C)}G();if($(this).attr("isvalid")=="1"){c()}return false});var u=parseInt(x.attr("isValid"))==1;if(u){var w=p.find('input[type="text"]');var v=w.prev("a");var ab=w.next("a");var Z=/^\d+$/;var ah=parseInt(w.val());var ai=parseInt(w.attr("surplus"));var aj=parseInt(w.attr("limitbuy"));var aa=parseInt(w.attr("myLimitSales"));var ae=aj-aa;var q=function(I){if(!Z.test(I)){ah=1;p.find("li.f-cart-subtotal").html("\uffe51.00");ad();c();return}GetJPData(j,"updateCartNum","codeID="+Y+"&num="+I,function(J){if(J.code>0){if(J.num==1){a("goodsOff",function(){location.reload()})}ah=I;w.val(I);p.find("li.f-cart-subtotal").html("\uffe5"+I+".00");ad();c()}else{w.val(ah);p.find("li.f-cart-subtotal").html("\uffe5"+ah+".00");ad();c()}})};var o=function(I){if(I==""){w.parent().next("p").hide()}else{if(w.parent().next("p").length==0){w.parent().after("<p>"+I+"</p>")}else{w.parent().next("p").html(I).show()}}};var ac=function(){if(aj>0){var I="\u9650\u8d2d"+aj+"\u4eba\u6b21";if(ae>0&&aa>0){I="\u9650\u8d2d"+aj+"\u4eba\u6b21\uff0c\u60a8\u5df2\u53c2\u4e0e"+aa+"\u4eba\u6b21"}if(w.parent().next("p").length==0){w.parent().after('<p class="gray9">'+I+"</p>")}else{w.parent().next("p").addClass("gray9").html(I).show()}}else{w.parent().next("p").hide()}};ac();var W=function(I){if(I){if(p.next("div.m-list-tips").length==0){var J='<div class="m-list-tips clrfix"><span class="fl orange">\u6e29\u99a8\u63d0\u793a\uff1a\u5df2\u8d85\u8fc7100\u4eba\u6b21\uff0c1\u5143\u60ca\u559c\u5c31\u662f\u82b11\u5143\u5c31\u6709\u53ef\u80fd\u4e70\u52301\u4ef6\u5546\u54c1\uff0c\u662f\u4e00\u79cd\u5206\u4eab\u5f0f\u8d2d\u7269\u5e73\u53f0\uff0c\u53ef\u80fd\u5e26\u6765\u8d85\u503c\u56de\u62a5\u7684\u540c\u65f6\u4e5f\u5b58\u5728\u4e00\u5b9a\u98ce\u9669\uff0c\u8bf7\u8c28\u614e\u53c2\u4e0e\u54e6\uff01</span></div>';p.after(J)}}else{p.next("div.m-list-tips").remove()}};var ad=function(){if(ah==1){v.attr("class","z-arrows z-less2");ab.attr("class","z-arrows z-plus")}else{if(ah==ai||(ah==ae&&aj>0)){v.attr("class","z-arrows z-less");ab.attr("class","z-arrows z-plus2")}else{v.attr("class","z-arrows z-less");ab.attr("class","z-arrows z-plus")}}};var t=null;var X="\u4e0d\u80fd\u5c0f\u4e8e1\u4eba\u6b21";var af="\u4e0d\u80fd\u5927\u4e8e"+ai+"\u4eba\u6b21";var ag=ae==aj?"\u9650\u8d2d"+aj+"\u4eba\u6b21":"\u9650\u8d2d"+aj+"\u4eba\u6b21\uff0c\u60a8\u5df2\u53c2\u4e0e"+aa+"\u4eba\u6b21";var r="\u5df2\u8d85\u8fc7100\u4eba\u6b21\uff0c\u8bf7\u8c28\u614e\u53c2\u4e0e";w.keyup(function(J){var I=parseInt(w.val());var K=1;if(w.val()==""){K=""}else{if(!Z.test(I)){ac();K=ah}else{if(I==0){ac();K=1}else{if(I<=ai){ac();if(I>100){W(true)}else{W(false)}if(I>ae&&aj>0){I=ae;o(ag)}K=I}else{var L=af;K=ai;if(aj>0&&ae<ai){L=ag;K=ae}o(L)}}}}q(K)}).mouseover(function(){$("input:text[name=num]").each(function(J){var I=$(this).val();if((isNaN(I)||I=="0"||I=="")){$(this).blur()}});$(this).attr("mouseIn","1").focus().select();t=function(K){K=K||window.event;if(K&&K.preventDefault){K.preventDefault()}else{window.event.returnValue=false}var J=0;if(K.wheelDelta){J=K.wheelDelta>0?1:-1}else{if(K.detail){J=K.detail<0?1:-1}}if(J&&w.attr("mouseIn")=="1"){var I=parseInt(w.val());if(J>0){if(I>0){if(I>=ai){I=ai;if(aj==0){o(af)}}else{ac();I=I+1;if(I>100){W(true)}else{W(false)}if(I>ae&&aj>0){I=ae;o(ag)}}}else{I=1}}else{if(I>1){I=I-1;if(I>100){W(true)}else{W(false)}}else{I=1;if(aj==0){o(X)}}}w.val(I);p.find("li.f-cart-subtotal").html("\uffe5"+I+".00");ad();c()}};if(document.addEventListener){document.addEventListener("DOMMouseScroll",t,false)}window.onmousewheel=document.onmousewheel=t}).mouseout(function(){$(this).attr("mouseIn","0");var I=w.val();q(I);if(document.addEventListener){document.removeEventListener("DOMMouseScroll",t,false)}window.onmousewheel=document.onmousewheel=function(){}}).blur(function(){if(w.val()==""){ac();W(false);q(1)}});v.click(function(){var I=w.val();if(Z.test(I)){var J=parseInt(I);if(J>1){ac();J--;if(J>100){W(true)}else{W(false)}q(J);ad()}}return false});ab.click(function(){var I=w.val();if(Z.test(I)){var J=parseInt(I);if(J<ai){ac();J++;if(J>100){W(true)}else{W(false)}if(J>ae&&aj>0){J=ae;o(ag)}q(J);ad()}else{if(aj==0){o(af)}}}return false});if(parseInt(w.val())>100){W(true)}ad()}var s=p.find('a[type="delete"]');s.click(function(J){A(J);if($(this).attr("isOpen")=="1"){return}s.attr("isOpen","1");var I=function(){var M=function(){GetJPData(j,"deleteCart","codeID="+Y,function(P){if(P.code>0){d();var O=e.children("dd").length;if(O==1){location.replace("http://cart.1yyg.com/CartList.do")}else{p.next("div.m-list-tips").remove();p.animate({height:-20},{queue:false,duration:100,complete:function(){p.remove();O--;var Q=e.children("dd.m-cart-fail").length;if(O==Q){}else{c()}if(!u&&Q==0){$("#btnDelUnValid").remove()}if($("div.m-rqtj-con").offset().top<$(window).height()){loadImgFun()}}})}}else{a("delCartF",function(){location.reload()})}})};if(u){var N='<div class="z-popUp f-box-prompt '+(u?"":"f-box-gray")+'" style="display:none;"><p>\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f</p><a href="javascript:;" title="\u786e\u5b9a" class="u-btn-determine">\u786e\u5b9a</a><a href="javascript:;" title="\u53d6\u6d88" class="u-btn-cancel">\u53d6\u6d88</a><b><s></s></b></div>';var K=$(N);E.append(K);K.unbind("click").click(function(O){A(O)});var L=s.offset().top-e.offset().top+18;K.css("top",L+"px").show("fast",function(){K.find("a.u-btn-determine").unbind("click").click(function(){M()});K.find("a.u-btn-cancel").unbind("click").click(function(){d()})})}else{M()}};d(I);return false})};var H=function(r,q,o,p){GetJPData(j,"selectGoodsState","codeStr="+r+"&limitStr="+q,function(s){if(s.code==3){location.reload()}else{if(s.code==1){a("selGoodsState",function(){GetJPData(j,"updateGoodsState","FalseCode="+o+"&TrueCode="+r+"&BuyNum="+p,function(t){if(t.code>0){location.href=j+"/payment.do"}else{location.reload()}})},o)}else{GetJPData(j,"updateCartState","codeStr="+o,function(t){location.href=j+"/payment.do"})}}})};var d=function(p){var o=E.children("div.f-box-prompt");if(o.length>0){o.hide("fast",function(){E.find("div.f-box-prompt").remove();e.find('a[type="delete"]').each(function(){$(this).attr("isOpen","0")});if(p!=undefined){p()}})}else{if(p!=undefined){p()}}};E.click(function(){d()});$("body").click(function(){d()});e.children("dd").each(function(){$(this).CartItemFun()});var F=$("#sSelAll");var B=$("#btnSelAll");var b=function(){if(F.find("b").length>0){F.html("");e.find('a[type="check"]').each(function(){$(this).html("")})}else{F.html(C);e.find('a[type="check"]').each(function(){$(this).html(C)})}c()};F.click(function(){b();return false});B.click(function(){b();return false});G();$("#btnDelete").click(function(){var o=false;var p="";e.find('a[type="check"]').each(function(){if($(this).find("b").length>0){o=true;p+=$(this).attr("codeid")+","}});if(o){var q=function(){GetJPData(j,"deleteCart","codeID="+p,function(r){if(r.code>0){a("delCartS",function(){location.reload()})}else{a("delCartF",function(){location.reload()})}})};a("delCart",q)}else{a("delNone")}return false});$("#btnDelUnValid").click(function(){var o="";e.children("dd.m-cart-fail").each(function(){o+=$(this).find('a[type="check"]').attr("codeid")+","});GetJPData(j,"deleteCart","codeID="+o,function(p){if(p.code>0){a("delCartS",function(){location.reload()})}else{a("delCartF",function(){location.reload()})}});return false});$("#btnGoPay").click(function(){var r="";var s="";var w="";var q=e.find('a[type="check"]');var v=false;var u=false;var p="",t="";$.each(q,function(){if($(this).find("b").length>0){v=true;var x=$(this).parent().parent().parent().find('input[name="num"]');var J=$(this).parent().parent().parent().find('input[name="outlimit"]');if(J.length>0){u=true}t=x.val();if(t){p+=t+","}else{if(parseInt(x.attr("limitbuy"))>0){p+=0+","}else{p+=1+","}}if(parseInt(x.attr("limitbuy"))>0){w+=$(this).attr("codeid")+","}s+=$(this).attr("codeid")+","}else{r+=$(this).attr("codeid")+","}});if(v&&!u){v=true;$("input:text[name=num]").each(function(x){var J=$(this).val();if($(q[x]).find("b").length>0&&(isNaN(J)||J=="0"||J=="")){v=false}});if(!v){a("buyNumErr")}else{var o=function(){GetJPData(j,"checkLogin","",function(J){if(J.code==1){var x=new popLogin();PagePOPLoginOK=function(){x.hide();H(s,w,r,p)};x.show()}else{H(s,w,r,p)}})};o()}}else{if(u){h()}else{a("selEmpty")}}});$("#divRecList").children("div").each(function(p,q){var o=$(this);o.hover(function(){o.addClass(p==3?"f-recomm-hover f-recomm-hover2":"f-recomm-hover");o.append('<div class="z-mask"></div><a href="javascript:;" class="u-cart-add transparent-png"></a>');o.children("a.u-cart-add").click(function(){GetJPData(j,"shopCartNew","codeID="+$(this).parent().attr("codeid")+"&num=1",function(r){if(r.code==0){a("addCartS",function(){if(location.href.indexOf("#divRec")>-1){location.reload()}else{location.replace("http://cart.1yyg.com/cartlist.do#divRec")}},o.find("a.u-cart-add"))}else{if(r.code==1){a("goodsOff",function(){location.replace(location.href)})}else{a("addCartF",function(){location.replace(location.href)},o.find("a.u-cart-add"))}}});return false})},function(){o.removeClass(p==3?"f-recomm-hover f-recomm-hover2":"f-recomm-hover");o.children("div.z-mask").remove();o.children("a.u-cart-add").remove()})})};Base.getScript(skinDomain+"/JS/popLogin.js?date=150703",l)});
