var userUploadFun=null;$(function(){var l=$skin;var m="";var p=$("#pageForm");var u=p.find("div.localBtn");var o=p.find("div.upImgLoading");var r,n;var v=u.find("div.btn");var s=$("#fuploadFile");u.parent().mousemove(function(a){var b=$(window).width();if(n!=b){n=b;r=u.offset()}$("#FileControl").css({top:(a.pageY-r.top-7)+"px",left:(a.pageX-r.left-190)+"px"});v.attr("class","btnhov")}).mouseout(function(a){v.attr("class","btn")});s.mouseover(function(){$(this).css("cursor","pointer")});var q=function(){this.ShowUploadPic=function(a){p.get(0).reset();o.addClass("hidden");u.removeClass("hidden");var e=$("#ulPicBox");var c=$("#hidPicAll");var d=c.val();if(d.indexOf(a)<0){d+=(d==""?"":",")+a;c.val(d);var b='<div id="img'+a.substr(0,13)+'"><img src="/uploadImages/'+a+'" alt="" /><a href="javascript:;" onclick="javascript:delPostPic(\''+a+"');\">\u5220\u9664\u6b64\u56fe\u7247</a></div>";e.append(b);OKDialog("\u56fe\u7247\u4e0a\u4f20\u6210\u529f\uff01")}else{return false}};this.ShowUploadErr=function(a){p.get(0).reset();o.addClass("hidden");u.removeClass("hidden");FailDialog(a,250)}};userUploadFun=new q();s.bind("change",function(){var a=$(this).val();if(a!=""){var b=(a.substr(a.length-5)).substr((a.substr(a.length-5)).indexOf(".")+1).toLowerCase();if(b!="png"&&b!="jpg"&&b!="bmp"){$(this).val("");FailDialog("\u53ea\u80fd\u4e0a\u4f20JPG\u3001PNG\u6216BMP\u56fe\u7247!",250);return false}else{u.addClass("hidden");o.removeClass("hidden");p.submit()}}else{FailDialog("\u8bf7\u5148\u9009\u62e9\u9700\u8981\u4e0a\u4f20\u7684\u6587\u4ef6!",210);return false}});var t=function(){var d=["\u6807\u9898\u4e0d\u5c11\u4e8e5\u4e2a\u5b57","\u606d\u559c\u60a8\u60ca\u559c\u6210\u529f\uff0c\u5728\u6b64\u8f93\u5165\u60a8\u7684\u60ca\u559c\u611f\u8a00\u5427\uff0c\u5185\u5bb9\u4e0d\u5c11\u4e8e50\u5b57\uff0c\u5ba1\u6838\u901a\u8fc7\u5373\u53ef\u83b7\u5f971000\u798f\u5206\u5956\u52b1\u54e6\uff01"];var g=$("#postID").val();var b=$("#hidPicAll");var c=$("#ulPicBox");m=$("#imgFileUrl").val();$("#postTitle").focus(function(){var h=$(this).val();if(h==d[0]){$(this).val("").attr("class","title_click")}}).blur(function(){if($(this).val()==""){$(this).val(d[0]).attr("class","title")}});$("#postContent").focus(function(){var h=$(this).val();if(h==d[1]){$(this).val("").attr("class","textarea_click")}}).blur(function(){if($(this).val()==""){$(this).val(d[1]).attr("class","textarea")}});if(b.val()!=""){_PicArr=b.val().split(",");for(var e=0;e<_PicArr.length;e++){c.append('<div id="img'+_PicArr[e].substr(0,13)+'"><img src="/UserPost/Small/'+_PicArr[e]+'" alt="" /><a href="javascript:;" title="\u5220\u9664\u6b64\u56fe\u7247" onclick="javascript:delPostPic(\''+_PicArr[e]+"');\">\u5220\u9664\u6b64\u56fe\u7247</a></div>")}}var a=function(){OKDialog("\u63d0\u4ea4\u6210\u529f!",160);location.replace("/user/PostSingleList.html")};var f=function(i,h){FailDialog(h,220);if(i!=null){i.focus().val(i.val())}};$("#but_ok").click(function(){if(!isLoaded){return false}var h=$("#postTitle").val();var j=$("#postTitle");var k=$("#postContent").val();var i=$("#postContent");var x=$("#hidPicAll").val();var y=$("#hidPicAll").val().split(",");if(h==""||h==d[0]){f(j,"\u8bf7\u8f93\u5165\u4e3b\u9898\uff01");return false}if(h.length>100){f(j,"\u4e3b\u9898\u4e0d\u80fd\u8d85\u8fc7100\u5b57\uff01");return false}if(h.length<5){f(j,"\u4e3b\u9898\u4e0d\u80fd\u5c11\u4e8e5\u4e2a\u5b57\uff01");return false}if(k==""||k==d[1]){f(i,"\u8bf7\u8f93\u5165\u83b7\u5f97\u611f\u8a00\uff01");return false}if(k.length>800){f(i,"\u83b7\u5f97\u611f\u8a00\u4e0d\u80fd\u8d85\u8fc7800\u5b57\uff01");return false}if(k.length<100){f(i,"\u83b7\u5f97\u611f\u8a00\u4e0d\u80fd\u5c11\u4e8e100\u4e2a\u5b57\uff01");return false}if(x.length<53){f("","\u8bf7\u4e0a\u4f203\u5f20\u4ee5\u4e0a\u539f\u521b\u56fe\u7247\uff01");return false}if(y.length>10){f("","\u6700\u591a\u53ea\u80fd\u4e0a\u4f2010\u5f20\u56fe\u7247\uff01");return false}$.ajax({url:"/user/PostSingleEditShare.action",type:"post",data:"id="+g+"&postTitle="+h+"&postContent="+k+"&postAllPic="+x,success:function(w){if(w=="true"){OKDialog("\u63d0\u4ea4\u6210\u529f!",160);location.replace("/user/PostSingleList.html")}else{OKDialog("\u63d0\u4ea4\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5!",200)}},error:function(){g(null,"\u63d0\u4ea4\u5931\u8d25\uff01")}})});$("#upFrame").load(function(){var h=$(window.frames.upFrame.document.body).text();if(h!=null){UploadFileScriptAPI("",h)}});$("#addnewPostPic").click(function(){var h=$("#hidPicAll").split(",");alert(h);if(h.length<10){$.PageDialog('<iframe name="PostSingleFrame" id="PostSingleFrame"  scrolling="no" width="398" height="100" frameborder="0" src="about:blank"></iframe>',{W:398,H:150,title:"\u4e0a\u4f20\u65b0\u6652\u5355\u56fe\u7247"});$("#PostSingleFrame").ready(function(){$("#PostSingleFrame").attr("src","uploadPostImg.html")})}else{alert("\u6700\u591a\u53ea\u80fd\u4e0a\u4f2010\u5f20\u56fe\u7247\uff01")}});isLoaded=true};$.getScript(l+"/js/ajaxfun.js?date=20130123",t)});function UploadFileScriptAPI(c,d){if(c!=""){userUploadFun.ShowUploadErr(c)}else{userUploadFun.ShowUploadPic(d)}}function delPostPic(d){var c=function(){var b=$("#hidPicAll");var a=b.val();if(a.indexOf(d)!=-1){a=(","+a+",").replace(","+d+",",",");b.val(a.substr(1,a.length-2))}$("#img"+d.substr(0,13)).remove()};ConfirmDialog("\u60a8\u786e\u5b9a\u8981\u5220\u9664\u8be5\u56fe\u7247\u5417\uff1f",c)};
